# BSC测试网 NFT市场部署指南

## 项目概述
这是一个基于BSC（币安智能链）测试网的去中心化NFT交易市场，使用Pinata IPFS存储NFT元数据。

## 技术栈
- **前端**: Next.js 12 + React 17
- **智能合约**: Solidity + Hardhat
- **区块链交互**: ethers.js + Web3Modal
- **存储**: Pinata IPFS
- **样式**: TailwindCSS

## 快速开始

### 1. 环境准备

#### 安装依赖
```bash
npm install
```

#### 配置MetaMask
1. 安装MetaMask浏览器扩展
2. 添加BSC测试网：
   - 网络名称: BSC Testnet
   - RPC URL: https://data-seed-prebsc-1-s1.binance.org:8545/
   - 链ID: 97
   - 货币符号: BNB
   - 区块浏览器: https://testnet.bscscan.com

#### 获取测试BNB
访问 https://testnet.binance.org/faucet-smart 获取免费测试BNB

### 2. Pinata配置

#### 注册Pinata账号
1. 访问 https://app.pinata.cloud/register
2. 注册并验证邮箱

#### 创建API密钥
1. 登录Pinata Dashboard
2. 进入 API Keys 页面
3. 点击 "New Key"
4. **重要**: 选择 "Admin" 权限（包含所有必要权限）
5. 创建并保存密钥

### 3. 项目配置

#### 创建环境变量文件
```bash
# 复制示例文件
cp .env.example .env.local

# 编辑.env.local，添加你的Pinata密钥
NEXT_PUBLIC_PINATA_API_KEY=你的API密钥
NEXT_PUBLIC_PINATA_SECRET_API_KEY=你的Secret密钥
NEXT_PUBLIC_PINATA_GATEWAY=https://gateway.pinata.cloud/ipfs
```

#### 创建私钥文件
```bash
# 创建.secret文件，添加你的钱包私钥（不含0x前缀）
echo "你的钱包私钥" > .secret
```

### 4. 部署智能合约

#### 编译合约
```bash
npx hardhat compile
```

#### 部署到BSC测试网
```bash
npx hardhat run scripts/deploy.js --network bscTestnet
```

#### 更新合约地址
将部署后的合约地址更新到 `context/constants.js`：
```javascript
export const MarketAddress = '部署后的合约地址';
```

### 5. 运行项目

```bash
npm run dev
```

访问 http://localhost:3000

## 功能说明

### 核心功能
- **铸造NFT**: 上传图片创建NFT（需支付0.025 BNB手续费）
- **购买NFT**: 从市场购买其他人的NFT
- **出售NFT**: 将拥有的NFT挂单出售
- **我的NFT**: 查看个人拥有的所有NFT

### 使用流程
1. 连接MetaMask钱包（确保在BSC测试网）
2. 点击"Create NFT"上传图片并填写信息
3. 支付0.025 BNB铸造费用
4. NFT创建成功后自动上架到市场
5. 其他用户可以购买你的NFT

## 项目结构
```
nft/
├── contracts/          # 智能合约
│   └── NFTMarketplace.sol
├── context/           # 状态管理
│   ├── NFTContext.js  # 核心业务逻辑
│   └── constants.js   # 合约地址配置
├── pages/             # 页面组件
│   ├── index.js       # 市场主页
│   ├── create-nft.js  # 创建NFT
│   ├── my-nfts.js     # 我的NFT
│   └── nft-details.js # NFT详情
├── components/        # UI组件
├── scripts/           # 部署脚本
└── hardhat.config.js  # Hardhat配置
```

## 注意事项

### 环境变量
- `.env.local` 文件包含敏感信息，不要提交到Git
- `.secret` 文件包含私钥，务必保密

### Pinata限制
免费账户限制：
- 100个文件
- 1GB存储空间
- 每月1000次API调用

### 网络配置
确保所有操作都在BSC测试网进行：
- MetaMask网络设置为BSC Testnet
- 有足够的测试BNB支付Gas费

## 故障排查

### 常见问题

1. **上传图片失败**
   - 检查Pinata API密钥权限（需要Admin权限）
   - 确认.env.local文件配置正确

2. **创建NFT失败**
   - 确保钱包连接到BSC测试网
   - 检查是否有足够的BNB（至少0.05 BNB）
   - 确认合约地址正确

3. **图片无法显示**
   - 检查next.config.js中的图片域名配置
   - 清除浏览器缓存

4. **交易失败**
   - 增加Gas费
   - 检查网络连接
   - 等待区块确认

## 生产环境部署

### 1. 部署到BSC主网
修改 `hardhat.config.js` 添加主网配置：
```javascript
bscMainnet: {
  url: 'https://bsc-dataseed.binance.org/',
  chainId: 56,
  accounts: [privateKey],
}
```

### 2. 更新前端配置
- 使用生产环境的合约地址
- 配置生产环境的Pinata密钥
- 更新RPC节点为主网

### 3. 部署前端
推荐使用Vercel部署：
```bash
npm run build
# 部署到Vercel
vercel --prod
```

## 安全建议

1. **私钥管理**
   - 生产环境使用硬件钱包
   - 不要在代码中硬编码私钥

2. **API密钥**
   - 定期轮换API密钥
   - 生产环境建议使用后端代理

3. **合约安全**
   - 部署前进行安全审计
   - 考虑添加暂停机制

## 扩展功能建议

- 添加拍卖功能
- 支持批量上传
- 添加收藏品系列
- 实现版税机制
- 添加用户个人主页

## 技术支持

- BSC文档: https://docs.bnbchain.org/
- Pinata文档: https://docs.pinata.cloud/
- 项目源码: [当前仓库]

## 许可证
MIT License